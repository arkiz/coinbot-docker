<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8f9fa; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn { background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; }
        .btn:hover { background: #0056b3; }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #218838; }
        .btn-large { padding: 15px 30px; font-size: 16px; width: 100%; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #333; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
        .form-group small { color: #666; font-size: 12px; margin-top: 4px; display: block; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .alert { padding: 12px; border-radius: 4px; margin-bottom: 20px; }
        .alert.success { background: #d4edda; color: #155724; }
        .alert.error { background: #f8d7da; color: #721c24; }
        .back-link { display: inline-block; margin-bottom: 15px; color: #007bff; text-decoration: none; }
        .back-link:hover { text-decoration: underline; }
        .radio-group { display: flex; gap: 20px; align-items: center; }
        .radio-item { display: flex; align-items: center; gap: 8px; }
        .radio-item input[type="radio"] { margin: 0; }
        .radio-item label { margin: 0; font-weight: normal; cursor: pointer; }
        .warning-box { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 6px; margin-bottom: 20px; }
        .warning-box h4 { color: #856404; margin-bottom: 10px; }
        .warning-box p { color: #856404; margin: 0; line-height: 1.5; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1><%= title %></h1>
            <a href="/dashboard" class="back-link">← 대시보드로 돌아가기</a>
        </div>

        <% if (success && success.length > 0) { %>
            <div class="alert success"><%= success[0] %></div>
        <% } %>
        <% if (error && error.length > 0) { %>
            <div class="alert error"><%= error[0] %></div>
        <% } %>

        <!-- 경고 메시지 -->
        <div class="warning-box">
            <h4>⚠️ 거래 테스트 안내</h4>
            <p>
                <strong>드라이런 모드:</strong> 실제 거래 없이 시뮬레이션만 진행합니다. 안전하게 로직을 테스트할 수 있습니다.<br>
                <strong>실거래 모드:</strong> 실제 거래소에서 거래가 실행됩니다. 충분한 테스트 후에만 사용하세요.
            </p>
        </div>

        <!-- 설정 상태 확인 -->
        <% if (!botSettings.hasSettings) { %>
            <div class="card" style="text-align: center; padding: 40px;">
                <h3 style="color: #dc3545; margin-bottom: 15px;">❌ 봇 설정 필요</h3>
                <p style="margin-bottom: 20px;">거래를 실행하려면 먼저 봇 설정을 완료해주세요.</p>
                <a href="/dashboard/settings" class="btn btn-large">⚙️ 봇 설정하러 가기</a>
            </div>
        <% } else { %>
            <!-- 거래 실행 폼 -->
            <div class="card">
                <h2>🚀 수동 거래 실행</h2>
                <form action="/dashboard/trade/execute" method="POST">
                    <div class="form-row">
                        <div class="form-group">
                            <label>거래할 코인</label>
                            <select name="symbol" required>
                                <option value="">선택하세요</option>
                                <% coins.forEach(coin => { %>
                                    <option value="<%= coin.symbol %>"><%= coin.symbol %> - <%= coin.name %></option>
                                <% }); %>
                            </select>
                            <small>거래 가능한 코인만 표시됩니다</small>
                        </div>
                        <div class="form-group">
                            <label>거래 금액 (원)</label>
                            <input type="number" name="budget" required 
                                   min="<%= botSettings.min_trade_amount_krw || 100000 %>" 
                                   max="<%= botSettings.max_trade_amount_krw || 10000000 %>" 
                                   step="10000" 
                                   placeholder="1000000">
                            <small>
                                설정 범위: ₩<%= (botSettings.min_trade_amount_krw || 100000).toLocaleString() %> ~ ₩<%= (botSettings.max_trade_amount_krw || 10000000).toLocaleString() %>
                            </small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>실행 모드</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="dryRun_true" name="dryRun" value="true" checked>
                                <label for="dryRun_true">🧪 드라이런 (시뮬레이션)</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="dryRun_false" name="dryRun" value="false">
                                <label for="dryRun_false">💰 실거래 (실제 거래)</label>
                            </div>
                        </div>
                        <small>드라이런 모드를 먼저 테스트해보세요</small>
                    </div>

                    <button type="submit" class="btn btn-large btn-success" onclick="return confirmTrade()">
                        🚀 거래 실행
                    </button>
                </form>
            </div>
        <% } %>
    </div>

    <script>
        function confirmTrade() {
            const symbol = document.querySelector('select[name="symbol"]').value;
            const budget = document.querySelector('input[name="budget"]').value;
            const isDryRun = document.querySelector('input[name="dryRun"]:checked').value === 'true';
            
            if (!symbol || !budget) {
                alert('코인과 거래 금액을 입력해주세요.');
                return false;
            }

            const mode = isDryRun ? '시뮬레이션' : '실제 거래';
            const budgetFormatted = parseFloat(budget).toLocaleString();
            const message = `${symbol} 코인으로 ₩${budgetFormatted} ${mode}을 실행하시겠습니까?`;
            
            return confirm(message);
        }

        document.querySelector('input[name="dryRun"][value="false"]').addEventListener('change', function() {
            if (this.checked) {
                alert('⚠️ 실거래 모드는 실제 자금이 사용됩니다. 충분한 테스트 후에만 사용하세요.');
            }
        });
    </script>
</body>
</html>
