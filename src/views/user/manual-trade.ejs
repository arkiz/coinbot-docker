<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8f9fa; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn { background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; }
        .btn:hover { background: #0056b3; }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #218838; }
        .btn-large { padding: 15px 30px; font-size: 16px; width: 100%; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #333; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; }
        .form-group small { color: #666; font-size: 12px; margin-top: 4px; display: block; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .alert { padding: 12px; border-radius: 4px; margin-bottom: 20px; }
        .alert.success { background: #d4edda; color: #155724; }
        .alert.error { background: #f8d7da; color: #721c24; }
        .back-link { display: inline-block; margin-bottom: 15px; color: #007bff; text-decoration: none; }
        .back-link:hover { text-decoration: underline; }
        .radio-group { display: flex; gap: 20px; align-items: center; }
        .radio-item { display: flex; align-items: center; gap: 8px; }
        .radio-item input[type="radio"] { margin: 0; }
        .radio-item label { margin: 0; font-weight: normal; cursor: pointer; }
        .warning-box { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 6px; margin-bottom: 20px; }
        .warning-box h4 { color: #856404; margin-bottom: 10px; }
        .warning-box p { color: #856404; margin: 0; line-height: 1.5; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1><%= title %></h1>
            <a href="/dashboard" class="back-link">â† ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</a>
        </div>

        <% if (success && success.length > 0) { %>
            <div class="alert success"><%= success[0] %></div>
        <% } %>
        <% if (error && error.length > 0) { %>
            <div class="alert error"><%= error[0] %></div>
        <% } %>

        <!-- ê²½ê³  ë©”ì‹œì§€ -->
        <div class="warning-box">
            <h4>âš ï¸ ê±°ë˜ í…ŒìŠ¤íŠ¸ ì•ˆë‚´</h4>
            <p>
                <strong>ë“œë¼ì´ëŸ° ëª¨ë“œ:</strong> ì‹¤ì œ ê±°ë˜ ì—†ì´ ì‹œë®¬ë ˆì´ì…˜ë§Œ ì§„í–‰í•©ë‹ˆë‹¤. ì•ˆì „í•˜ê²Œ ë¡œì§ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                <strong>ì‹¤ê±°ë˜ ëª¨ë“œ:</strong> ì‹¤ì œ ê±°ë˜ì†Œì—ì„œ ê±°ë˜ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤. ì¶©ë¶„í•œ í…ŒìŠ¤íŠ¸ í›„ì—ë§Œ ì‚¬ìš©í•˜ì„¸ìš”.
            </p>
        </div>

        <!-- ì„¤ì • ìƒíƒœ í™•ì¸ -->
        <% if (!botSettings.hasSettings) { %>
            <div class="card" style="text-align: center; padding: 40px;">
                <h3 style="color: #dc3545; margin-bottom: 15px;">âŒ ë´‡ ì„¤ì • í•„ìš”</h3>
                <p style="margin-bottom: 20px;">ê±°ë˜ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ ë¨¼ì € ë´‡ ì„¤ì •ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.</p>
                <a href="/dashboard/settings" class="btn btn-large">âš™ï¸ ë´‡ ì„¤ì •í•˜ëŸ¬ ê°€ê¸°</a>
            </div>
        <% } else { %>
            <!-- ê±°ë˜ ì‹¤í–‰ í¼ -->
            <div class="card">
                <h2>ğŸš€ ìˆ˜ë™ ê±°ë˜ ì‹¤í–‰</h2>
                <form action="/dashboard/trade/execute" method="POST">
                    <div class="form-row">
                        <div class="form-group">
                            <label>ê±°ë˜í•  ì½”ì¸</label>
                            <select name="symbol" required>
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <% coins.forEach(coin => { %>
                                    <option value="<%= coin.symbol %>"><%= coin.symbol %> - <%= coin.name %></option>
                                <% }); %>
                            </select>
                            <small>ê±°ë˜ ê°€ëŠ¥í•œ ì½”ì¸ë§Œ í‘œì‹œë©ë‹ˆë‹¤</small>
                        </div>
                        <div class="form-group">
                            <label>ê±°ë˜ ê¸ˆì•¡ (ì›)</label>
                            <input type="number" name="budget" required 
                                   min="<%= botSettings.min_trade_amount_krw || 100000 %>" 
                                   max="<%= botSettings.max_trade_amount_krw || 10000000 %>" 
                                   step="10000" 
                                   placeholder="1000000">
                            <small>
                                ì„¤ì • ë²”ìœ„: â‚©<%= (botSettings.min_trade_amount_krw || 100000).toLocaleString() %> ~ â‚©<%= (botSettings.max_trade_amount_krw || 10000000).toLocaleString() %>
                            </small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>ì‹¤í–‰ ëª¨ë“œ</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="dryRun_true" name="dryRun" value="true" checked>
                                <label for="dryRun_true">ğŸ§ª ë“œë¼ì´ëŸ° (ì‹œë®¬ë ˆì´ì…˜)</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="dryRun_false" name="dryRun" value="false">
                                <label for="dryRun_false">ğŸ’° ì‹¤ê±°ë˜ (ì‹¤ì œ ê±°ë˜)</label>
                            </div>
                        </div>
                        <small>ë“œë¼ì´ëŸ° ëª¨ë“œë¥¼ ë¨¼ì € í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”</small>
                    </div>

                    <button type="submit" class="btn btn-large btn-success" onclick="return confirmTrade()">
                        ğŸš€ ê±°ë˜ ì‹¤í–‰
                    </button>
                </form>
            </div>
        <% } %>
    </div>

    <script>
        function confirmTrade() {
            const symbol = document.querySelector('select[name="symbol"]').value;
            const budget = document.querySelector('input[name="budget"]').value;
            const isDryRun = document.querySelector('input[name="dryRun"]:checked').value === 'true';
            
            if (!symbol || !budget) {
                alert('ì½”ì¸ê³¼ ê±°ë˜ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return false;
            }

            const mode = isDryRun ? 'ì‹œë®¬ë ˆì´ì…˜' : 'ì‹¤ì œ ê±°ë˜';
            const budgetFormatted = parseFloat(budget).toLocaleString();
            const message = `${symbol} ì½”ì¸ìœ¼ë¡œ â‚©${budgetFormatted} ${mode}ì„ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
            
            return confirm(message);
        }

        document.querySelector('input[name="dryRun"][value="false"]').addEventListener('change', function() {
            if (this.checked) {
                alert('âš ï¸ ì‹¤ê±°ë˜ ëª¨ë“œëŠ” ì‹¤ì œ ìê¸ˆì´ ì‚¬ìš©ë©ë‹ˆë‹¤. ì¶©ë¶„í•œ í…ŒìŠ¤íŠ¸ í›„ì—ë§Œ ì‚¬ìš©í•˜ì„¸ìš”.');
            }
        });
    </script>
</body>
</html>
